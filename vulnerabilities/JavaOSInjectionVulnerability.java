/**
 * Java OS Injection Vulnerability class
 *
 * @author Kristelle Lucero
 * @author Ed Klein
 */

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;

public class JavaOSInjectionVulnerability implements Vulnerability {

	/*
	* This method analyzes the code for the possibility of Operating System Injection
	*/
	public List<Integer> run(Analyzer ana){
		JavaAnalyzer javaAn = (JavaAnalyzer) ana;

		String osCommands[] = {"java.lang", "java.io","runtime.getruntime"}; 
		//^^^^these are packages that are most likely to call OS commands, or commonly exploited OS commands
		String osWhiteList[] = {}; //if the code contains a white list of acceptable characters then it is at less risk of OS injection
		String osBlackList[] = {"|",":",";","$","<",">","`","\\","/","!","{","}","(",")","[","]","&","*","+","=","?","-","#","~",".","\"","%"}; 
		//^^^these are unsafe characters. Check to see if program uses a blacklist

		String contents = "";
		ArrayList<Integer> vulnLines = new ArrayList<>(); //a list of line numbers that the vulnerability was found on
		
		//gather the contents of the file from the java analyzer
		contents = javaAn.getFileContents();
		//switch to lowercase to make comparisons easier
		contents = contents.toLowerCase();

		//check for key words that might indicate an operating system call
		for (String key : osCommands) {
			
			//if the file contains those keywords
			if (contents.contains(key)) {
				//add the line number 
				vulnLines.addAll(javaAn.getSymbolToLine().get(key));
			}
		}
		// check to see if the program either utilizes a white list
		// or if the program sanitizes the input
		// if there's no whitelist and there's no input sanitization
		// mark the lines where OS command is called

		return vulnLines;
	}
}